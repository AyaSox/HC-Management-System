# Render Blueprint - Deploy HRMS and ESS sharing same SQLite database
# Database resets on each deployment/restart (free tier behavior)
# HRMS seeds all data including demo employees
services:
  # HR Management System - Primary source of truth
  - type: web
    name: hr-management-system
    runtime: docker
    plan: free
    region: oregon
    branch: main
    rootDir: HRManagementSystem
    dockerfilePath: ./Dockerfile
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ASPNETCORE_URLS
        value: http://+:8080
      - key: ConnectionStrings__DefaultConnection
        value: Data Source=/tmp/hrmanagement.db
      - key: ESS_SYSTEM_URL
        value: https://ess-leave-system.onrender.com
    buildCommand: echo "Building HRMS - will seed demo data on startup"
    startCommand: dotnet HRManagementSystem.dll

  # ESS Leave System - Shares same database
  - type: web
    name: ess-leave-system
    runtime: docker
    plan: free
    region: oregon
    branch: main
    rootDir: .
    dockerfilePath: ./ESSLeaveSystem/Dockerfile
    dockerContext: .
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ASPNETCORE_URLS
        value: http://+:8080
      - key: ConnectionStrings__DefaultConnection
        value: Data Source=/tmp/hrmanagement.db
      - key: HRMS_URL
        value: https://hr-management-system-jstj.onrender.com
      # JWT settings for API communication
      - key: JwtSettings__SecretKey
        generateValue: true
      - key: JwtSettings__Issuer
        value: ESSLeaveSystem
      - key: JwtSettings__Audience
        value: HRManagementSystem
    buildCommand: echo "Building ESS - will use HRMS seeded data"
    startCommand: dotnet ESSLeaveSystem.dll